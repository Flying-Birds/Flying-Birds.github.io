<!-- Contact -->
{% if site.locale and site.locale != "" and site.locale != nil %}
<section class="page-section" id="{{ site.data.sitetext[site.locale].contact.section | default: 'contact' }}">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <h2 class="section-heading text-uppercase">
          {{ site.data.sitetext[site.locale].contact.title | markdownify | default: 'Contact Us' }}</h2>
        <h3 class="section-subheading text-muted">{{ site.data.sitetext[site.locale].contact.text | default: '' }}</h3>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <form id="contactForm" novalidate="novalidate">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <input name="name" class="form-control" id="name" type="text"
                  placeholder="{{ site.data.sitetext[site.locale].contact.name | default: 'Name*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.name-validation | default: 'Please enter your name.' }}">
                <p class="help-block text-danger"></p>
              </div>
              <div class="form-group d-none">
                <input name="username" class="form-control" id="username" type="text" tabindex="-1" autocomplete="off">
              </div>
              <div class="form-group">
                <input name="_replyto" class="form-control" id="email" type="email"
                  placeholder="{{ site.data.sitetext[site.locale].contact.email | default: 'Email*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.email-validation | default: 'Please enter your email address.' }}">
                <p class="help-block text-danger"></p>
              </div>
              <div class="form-group">
                <input name="phone" class="form-control" id="phone" type="tel"
                  placeholder="{{ site.data.sitetext[site.locale].contact.phone | default: 'Phone Number*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.phone-validation | default: 'Please enter your phone number.' }}">
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <textarea name="message" class="form-control" id="message"
                  placeholder="{{ site.data.sitetext[site.locale].contact.message | default: 'Message*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.message-validation | default: 'Please enter a message.' }}"></textarea>
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="clearfix"></div>
            <div class="col-lg-12 text-center">
              <!-- 添加错误信息显示元素 -->
              <div id="errorMessage" class="text-danger mb-3" style="min-height: 24px;"></div>
              <div id="success"></div>
              <button id="sendMessageButton" class="btn btn-primary btn-xl text-uppercase"
                type="submit">{{ site.data.sitetext[site.locale].contact.submit | default: 'Send Message' }}</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
{% else %}
<!-- 其他语言版本的 Contact -->
<section class="page-section" id="{{ site.data.sitetext[site.locale].contact.section | default: 'contact' }}">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <h2 class="section-heading text-uppercase">
          {{ site.data.sitetext[site.locale].contact.title | markdownify | default: '联系我们' }}</h2>
        <h3 class="section-subheading text-muted">{{ site.data.sitetext[site.locale].contact.text | default: '' }}</h3>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <form id="contactForm" novalidate="novalidate">
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <input name="name" class="form-control" id="name" type="text"
                  placeholder="{{ site.data.sitetext[site.locale].contact.name | default: '姓名*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.name-validation | default: '请输入您的姓名。' }}">
                <p class="help-block text-danger"></p>
              </div>
              <div class="form-group d-none">
                <input name="username" class="form-control" id="username" type="text" tabindex="-1" autocomplete="off">
              </div>
              <div class="form-group">
                <input name="_replyto" class="form-control" id="email" type="email"
                  placeholder="{{ site.data.sitetext[site.locale].contact.email | default: '邮箱*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.email-validation | default: '请输入您的邮箱地址。' }}">
                <p class="help-block text-danger"></p>
              </div>
              <div class="form-group">
                <input name="phone" class="form-control" id="phone" type="tel"
                  placeholder="{{ site.data.sitetext[site.locale].contact.phone | default: '电话号码*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.phone-validation | default: '请输入您的电话号码。' }}">
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <textarea name="message" class="form-control" id="message"
                  placeholder="{{ site.data.sitetext[site.locale].contact.message | default: '留言*' }}"
                  required="required" data-validation-required-message="{{ site.data.sitetext[site.locale].contact.message-validation | default: '请输入留言内容。' }}"></textarea>
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="clearfix"></div>
            <div class="col-lg-12 text-center">
              <!-- 添加错误信息显示元素 -->
              <div id="errorMessage" class="text-danger mb-3" style="min-height: 24px;"></div>
              <div id="success"></div>
              <button id="sendMessageButton" class="btn btn-primary btn-xl text-uppercase"
                type="submit">{{ site.data.sitetext[site.locale].contact.submit | default: '发送留言' }}</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
{% endif %}

<script>
    // 确保DOM完全加载后执行
    document.addEventListener('DOMContentLoaded', function() {
        const contactForm = document.getElementById('contactForm');
        
        // 检查表单元素是否存在
        if (!contactForm) {
            console.error('Contact form element not found!');
            return;
        }

        contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // 获取错误信息显示元素并检查
            const errorDiv = document.getElementById('errorMessage');
            if (!errorDiv) {
                console.error('Error message element not found!');
                alert('提交失败：缺少错误提示元素');
                return;
            }
            
            // 清空之前的错误信息
            errorDiv.textContent = '';
            
            try {
                // 收集表单数据（包括电话字段）
                const data = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    message: document.getElementById('message').value
                };

                // GitHub仓库信息
                const repoOwner = 'Flying-Birds';
                const repoName = 'Flying-Birds.github.io';
                const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/dispatches`;

                // 发送请求到GitHub API
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'GitHub Pages Contact Form',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        event_type: 'proxy-contact-form',
                        client_payload: data
                    }),
                    mode: 'cors'
                });

                const responseText = await response.text();
                
                if (response.ok) {
                    // 显示成功信息
                    document.getElementById('success').textContent = '消息发送成功！';
                    document.getElementById('success').className = 'text-success mb-3';
                    // 重置表单
                    this.reset();
                    // 3秒后清除成功信息
                    setTimeout(() => {
                        document.getElementById('success').textContent = '';
                    }, 3000);
                } else {
                    // 显示错误信息
                    errorDiv.textContent = `发送失败: ${response.status} - ${responseText.substring(0, 100)}`;
                    console.error('API响应状态:', response.status);
                    console.error('API响应内容:', responseText);
                }
            } catch (error) {
                errorDiv.textContent = `错误: ${error.message}`;
                console.error('请求异常:', error);
            }
        });
    });
</script>
